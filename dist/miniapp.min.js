!function(){if(/mobile/i.test(navigator.userAgent)){var e=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function t(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function n(e,t,n){var i;if(localStorage)localStorage.setItem(e,t);else{if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),i=", expires="+o.toGMTString()}else i="";document.cookie=e+"="+t+i+", path=/"}}function i(e){if(localStorage)return localStorage.getItem(e);for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null}function o(){var e=i("miniappuuid");return null===e&&(e=t(),n("miniappuuid",e,365)),e}function a(){this.addClass=function(e,t){this[e]=t},this.addService=function(e,t){this[e]=t},this.getGuid=function(){return s}}function r(){var e=new a;return e}var l,s=o();return{getInstance:function(){return l||(l=r()),l}}}();!function(){e.getInstance().addService("http",function(){function t(e,t){var n=new XMLHttpRequest;n.open("HEAD",e),n.onreadystatechange=function(e){console.log(this.getAllResponseHeaders()),4==this.readyState&&200==this.status&&t(404!=this.status)},n.send()}function n(e,t,n){var i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(e){if(4==this.readyState&&200==this.status)try{var t=JSON.parse(this.response);n(t)}catch(i){n({})}};var o="";for(var a in t)o+=a+"="+t[a]+"&";i.send(o)}function i(e,t){n(r+"/api/miniapps/initparams/",e,function(e){t(e)})}function o(e,t){n(r+"/api/miniapps/related/",e,function(e){t(e)})}function a(t,i,o,a){var l={};navigator&&(l.language=navigator.language);var s={clientID:"",deviceID:"",action:t,timestamp:(new Date).getTime(),hostAppName:"haaretz",miniAppName:o||"",sdkVersion:"1.0web",hostAppUserId:"",os_name:"",os_version:"",device_brand:"",device_manufacturer:"",device_model:"",device_type:"",carrier:"web",language:l.language,ip:"",adIdentifier:e.getInstance().getGuid(),adid:"",articleURL:i,presentedMiniapps:a||["","","",""]};n(r+"/api/engagment/create/",s,function(){})}var r="http://dev.miniapp.me";return{getPanelStyle:i,getMiniapps:o,engageEvent:a,getHeaders:t}}())}(),function(){e.getInstance().addService("utils",function(){function e(){return/iPhone/i.test(navigator.userAgent)}function t(){return!/chrome|CriOS/i.test(navigator.userAgent)}return{isiPhone:e,isNotChrome:t}}())}(),function(){function t(e){function t(){return l}function n(e){y.push(e)}function i(e){s.style.boxShadow=e?"rgba(119, 219, 239, 0.75) 0px 0px 2px 2px":"none"}function o(){for(var e=0;e<y.length;e++)y[e](h)}function a(e){var t=document.createElement("div");t.style["float"]="left",t.style.marginRight="0px",t.style.marginLeft="0px",t.style.cursor="pointer",t.style.width="80px",t.style.textAlign="center",t.id=d,s=document.createElement("img"),s.style.borderRadius="5px",s.style.margin="auto",s.style.width="45px",s.style.height="45px",s.style.borderRadius="10px",s.src=c,t.appendChild(s);var n=document.createElement("div");n.style.textAlign="center",n.style.fontFamily="'Roboto', sans-serif",n.style.fontSize="11px",n.style.color="#ffffff",n.style.direction="rtl";var i=p;return i.length>12&&(i=i.substr(0,11)+".."),n.textContent=i,t.appendChild(n),t.addEventListener("touchstart",function(e){o()},!0),t}function r(){d=e.id,c=e.icon,p=e.name,u=e.appAddress,f=e.appDownloadLink,l=a()}if(!(e&&e.icon&&e.id))return null;var l,s,d,p,c,u,f,h,y=[];return r(),h={getElement:t,getAppAddress:function(){return u},getAppDownloadLink:function(){return f},getAppIcon:function(){return c},getAppName:function(){return p},getAppId:function(){return d},onClick:n,highlight:i}}e.getInstance().addClass("AppIcon",t)}(),function(){function t(e){function t(){var e="miniappFontCSS";if(!document.getElementById(e)){var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.id=e,n.rel="stylesheet",n.type="text/css",n.href="http://fonts.googleapis.com/css?family=Roboto:300",n.media="all",t.appendChild(n)}}function i(e){w.removeChild(e.getElement());for(var t=0;t<x.length;t++)if(e==x[t].app)return document.body.removeChild(x[t].frame.getElement()),x.splice(t,1),void h()}function o(){return x}function a(){v.style.display="none"}function r(){function t(){var e=parseInt(v.style.bottom)+1;v.style.bottom=e+"px",0>e?setTimeout(t,1):"function"==typeof i&&i(!0)}function n(){var e=parseInt(v.style.left)+16;v.style.left=e+"px",0>e?setTimeout(n,16):(v.style.left=0,"function"==typeof i&&i(!0))}if(!A){var i;if(x.length>0)switch(A=!0,e.AnimationType){case 0:v.style.left=-window.innerWidth+"px",v.style.display="block",n();break;case 2:v.style.display="block","function"==typeof i&&i(!1);break;default:v.style.bottom=-parseInt(v.style.height)+"px",v.style.display="block",t()}else"function"==typeof i&&i(!1);return{done:function(e){i=e}}}}function l(){return v}function s(t,n){e.preloadFrames!==!1&&(n.preLoadAppInFrame(t),n.onReady(p));var i=t&&t.getElement();i&&(w.appendChild(i),t.onClick(f),n.onHide(c),x.push({app:t,frame:n}),h())}function d(){}function p(e){for(var t=0;t<x.length;t++)if(!x[t].frame.isReady())return;A||r()}function c(e,t){if(e===b&&t){b=null;for(var n=0;n<x.length;n++)e==x[n].frame&&x[n].app.highlight(!1);u()}}function u(){for(var e=0;e<E.length;e++)E[e].element.style.display=E[e].display;E=[]}function f(t){for(var i=0;i<x.length;i++){var o=2!=e.AnimationType;if(b&&(o=!1),x[i].app==t)if(b===x[i].frame)n.http.engageEvent("CloseMiniApp",window.location.href,t.getAppId(),x.map(function(e){return e.app.getAppId()})),x[i].frame.hide(!0,!0),x[i].app.highlight(!1);else{n.http.engageEvent("OpenMiniApp",window.location.href,t.getAppId(),x.map(function(e){return e.app.getAppId()})),t.highlight(!0),x[i].frame.show(o);for(var a=0;a<document.body.children.length;a++)document.body.children[a]!=x[i].frame.getIframe()&&document.body.children[a]!=v&&document.body.children[a]!=x[i].frame.getElement()&&"none"!=document.body.children[a].style.display&&(E.push({element:document.body.children[a],display:document.body.children[a].style.display}),document.body.children[a].style.display="none");b||history.pushState({app:t.getAppName()},t.getAppName()),b=x[i].frame}else x[i].frame.hide(o),x[i].app.highlight(!1)}}function h(){for(var e=0,t=0;t<x.length;t++)e+=parseInt(x[t].app.getElement().style.width),e+=parseInt(x[t].app.getElement().style.marginLeft),e+=parseInt(x[t].app.getElement().style.marginRight);w.style.width=e+"px"}function y(t){var n=document.createElement("div"),i=document.createElement("div");return w=g(),i.style.position="relative",i.style.height=(t.PanelHeight||90)+"px",n.appendChild(i),i.appendChild(w),n.style.position="fixed",n.style.bottom=0,n.style.left=0,n.style.width="100%",n.style.height=(t.PanelHeight||90)+"px",n.style.opacity=t.PanelAlpha||1,n.style.backgroundColor=t.PanelBackground||"#404040",n.style.display="none",n.style.zIndex=1e3,n.style.webkitTransform="translateZ(2px)",n.style.webkitBackfaceVisibility="hidden",e.id&&(n.id=e.id),n}function g(){var e=document.createElement("div");return e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.webkitTransform="translate(-50%, -50%)",e}function m(){t(),v=y(e),d(),document.body.appendChild(v),window.addEventListener("resize",function(){d()},!0),window.addEventListener("popstate",function(e){if(b){b.hide(!1,!1);for(var t=0;t<x.length;t++)b==x[t].frame&&x[t].app.highlight(!1);b=null,u()}},!0),v.addEventListener("touchmove",function(e){e.stopPropagation(),e.preventDefault()},!0)}e||(e={});var v,w,b,x=[],A=!1,E=[];return m(),{addMiniapp:s,removeMiniapp:i,getMiniapps:o,setStyle:{},getElement:l,hide:a,show:r}}var n=e.getInstance();n.addClass("Panel",t)}(),function(){function t(e){function t(){return I}function i(e){E.push(e)}function o(e){A.push(e)}function a(){return h}function r(){return g}function l(t,n){function i(){var e=parseInt(h.style.left)-16;h.style.left=e+"px",e>-window.innerWidth?setTimeout(i,16):(h.style.left=-window.innerWidth+"px",y.style.display="none",g.style.display="none",h.style.display="none")}if(2==e.AnimationType&&(t=!1),x){t===!1?(h.style.left=-window.innerWidth+"px",y.style.display="none",g.style.display="none",h.style.display="none"):i(),x=!1;for(var o=0;o<A.length;o++)A[o](b,n)}}function s(e){function t(){var e=parseInt(h.style.left)+16;h.style.left=e+"px",0>e?setTimeout(t,16):h.style.left=0}y.src=w.getAppAddress(),g.style.display="block",h.style.display="block",y.style.display="block",e===!1?h.style.left=0:(h.style.left=-window.innerWidth+"px",t()),x=!0}function d(e){h.style.left=-window.innerWidth+"px",v.textContent=e.getAppName(),w=e}function p(e){var t=document.createElement("div");return m=c(e),t.appendChild(m),t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="100%",t.style.zIndex=1e3,y=document.createElement("iframe"),g=document.createElement("div"),g.style.webkitOverflowScrolling="touch",g.style.overflow="scroll",g.style.width=window.innerWidth+"px",g.style.margin=0,g.style.display="none",g.style.zIndex=999,g.style.marginLeft="-8px",g.style.marginTop="45px",n.utils.isiPhone()||(g.style.height=window.innerHeight+"px"),g.style.backgroundColor="white",g.appendChild(y),y.width=window.innerWidth+"px",y.height="100%",y.style.border="none",y.addEventListener("load",function(){if(y.src){I=!0;for(var e=0;e<E.length;e++)E[e](b)}},!0),document.body.insertBefore(g,document.body.firstElementChild),t}function c(e){var t=document.createElement("div");t.style.textAlign="center",t.style.backgroundColor="#ffffff",t.style.border="1px #007AFF solid",t.style.height="45px",t.style.position="relative";var n=document.createElement("div");n.style.position="absolute",n.style.top="50%",n.style.width="100%",n.style.left=0,n.style.transform="translate(0, -50%)",n.style.webkitTransform="translate(0, -50%)",n.style.color="#000000",t.appendChild(n),v=document.createElement("span"),n.appendChild(v);var i=document.createElement("div");i.textContent=e.BackNavigationText,i.style["float"]="left",i.style.marginLeft="10px",i.style.cursor="pointer",window.getComputedStyle&&(i.style.fontFamily=window.getComputedStyle(document.body).fontFamily),i.style.fontSize="18px",i.style.color="#007AFF",i.addEventListener("touchstart",function(e){l(!0,!0)},!0),n.appendChild(i);var o=document.createElement("img");return o.style["float"]="right",o.src="http://www.haaretz.co.il/htz/images/mobileweb/logo-haaretz.png",n.appendChild(o),t}function u(){}function f(){h=p(e||{}),document.body.appendChild(h),window.addEventListener("resize",function(){u()},!0)}e||(e={});var h,y,g,m,v,w,b,x=!1,A=[],E=[],I=!1;return f(),b={getElement:a,preLoadAppInFrame:d,show:s,hide:l,onHide:o,isReady:t,onReady:i,getIframe:r}}var n=e.getInstance();n.addClass("DisplayFrame",t)}(),function(){document.body.onload=function(){console.log("MiniAppSDK init");var t,n=e.getInstance(),i={publisher:"haaretz"};n.http.engageEvent("OpenArticle",window.location.href),n.http.getPanelStyle(i,function(e){e&&e[0]&&(e=e[0]),t=n.Panel(e);var i={link:window.location.href,publisher:"haaretz"};n.http.getMiniapps(i,function(i){console.log("MiniAppSDK "+i.length+" MiniApps"),i&&i.length&&i.length>0&&n.http.engageEvent("ShowMiniAppPanel",window.location.href,"",i.map(function(e){return e.id}));for(var o=0;o<i.length;o++)if(i[o]){var a=n.DisplayFrame(e),r=n.AppIcon(i[o]);t.addMiniapp(r,a),n.http.engageEvent("Impression",window.location.href,i[o].id,i.map(function(e){return e.id}))}setTimeout(function(){t.show()},e.LoadingTimeout||1e4)})}),console.log("MiniAppSDK init completed")}}()}}();