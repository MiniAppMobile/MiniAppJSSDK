!function(){if(/mobile/i.test(navigator.userAgent)){var e=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function t(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function n(e,t,n){var i;if(localStorage)localStorage.setItem(e,t);else{if(n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),i=", expires="+a.toGMTString()}else i="";document.cookie=e+"="+t+i+", path=/"}}function i(e){if(localStorage)return localStorage.getItem(e);for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var a=n[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null}function a(){var e=i("miniappuuid");return null===e&&(e=t(),n("miniappuuid",e,365)),e}function o(){this.addClass=function(e,t){this[e]=t},this.addService=function(e,t){this[e]=t},this.getGuid=function(){return s}}function r(){var e=new o;return e}var l,s=a();return{getInstance:function(){return l||(l=r()),l}}}();!function(){e.getInstance().addService("http",function(){function t(e,t,n){var i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(e){if(4==this.readyState&&200==this.status)try{var t=JSON.parse(this.response);n(t)}catch(i){n({})}};var a="";for(var o in t)a+=o+"="+t[o]+"&";i.send(a)}function n(e,n){t(o+"/api/miniapps/initparams/",e,function(e){n(e)})}function i(e,n){t(o+"/api/miniapps/related/",e,function(e){n(e)})}function a(n,i,a,r){var l={};navigator&&(l.language=navigator.language);var s={clientID:"",deviceID:"",action:n,timestamp:(new Date).getTime(),hostAppName:"haaretz",miniAppName:a||"",sdkVersion:"1.0web",hostAppUserId:"",os_name:"",os_version:"",device_brand:"",device_manufacturer:"",device_model:"",device_type:"",carrier:"web",language:l.language,ip:"",adIdentifier:e.getInstance().getGuid(),adid:"",articleURL:i,presentedMiniapps:r||["","","",""]};t(o+"/api/engagment/create/",s,function(){})}var o="http://dev.miniapp.me";return{getPanelStyle:n,getMiniapps:i,engageEvent:a}}())}(),function(){e.getInstance().addService("utils",function(){function e(){return/iPhone/i.test(navigator.userAgent)}function t(){return!/chrome|CriOS/i.test(navigator.userAgent)}return{isiPhone:e,isNotChrome:t}}())}(),function(){function t(e){function t(){return l}function n(e){g.push(e)}function i(e){s.style.boxShadow=e?"rgba(119, 219, 239, 0.75) 0px 0px 2px 2px":"none"}function a(){for(var e=0;e<g.length;e++)g[e](h)}function o(e){var t=document.createElement("div");t.style["float"]="left",t.style.marginRight="0px",t.style.marginLeft="0px",t.style.cursor="pointer",t.style.width="80px",t.style.textAlign="center",t.id=p,s=document.createElement("img"),s.style.borderRadius="5px",s.style.margin="auto",s.style.width="45px",s.style.height="45px",s.style.borderRadius="10px",s.src=c,t.appendChild(s);var n=document.createElement("div");n.style.textAlign="center",n.style.fontFamily="'Roboto', sans-serif",n.style.fontSize="11px",n.style.color="#ffffff";var i=d;return i.length>12&&(i=i.substr(0,10)+"..."),n.textContent=i,t.appendChild(n),t.onclick=function(){a()},t}function r(){p=e.id,c=e.icon,d=e.name,u=e.appAddress,f=e.appDownloadLink,l=o()}if(!(e&&e.icon&&e.id))return null;var l,s,p,d,c,u,f,h,g=[];return r(),h={getElement:t,getAppAddress:function(){return u},getAppDownloadLink:function(){return f},getAppIcon:function(){return c},getAppName:function(){return d},getAppId:function(){return p},onClick:n,highlight:i}}e.getInstance().addClass("AppIcon",t)}(),function(){function t(e){function t(){var e="miniappFontCSS";if(!document.getElementById(e)){var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.id=e,n.rel="stylesheet",n.type="text/css",n.href="http://fonts.googleapis.com/css?family=Roboto:300",n.media="all",t.appendChild(n)}}function i(e){v.removeChild(e.getElement());for(var t=0;t<x.length;t++)if(e==x[t].app)return document.body.removeChild(x[t].frame.getElement()),x.splice(t,1),void f()}function a(){return x}function o(){m.style.display="none"}function r(){function t(){var e=parseInt(m.style.bottom)+1;m.style.bottom=e+"px",0>e?setTimeout(t,1):"function"==typeof a&&a(!0)}function n(){var e=parseInt(m.style.left)+12;m.style.left=e+"px",0>e?setTimeout(n,16):(m.style.left=0,"function"==typeof a&&a(!0))}if(!b){for(var a,o=0;o<x.length;o++)console.log(x[o].app.getAppName()," : ",x[o].frame.isReady()),x[o].frame.isReady()||(i(x[o].app),o--);if(x.length>0)switch(b=!0,e.AnimationType){case 0:m.style.left=-window.innerWidth+"px",m.style.display="block",n();break;case 2:m.style.display="block","function"==typeof a&&a(!1);break;default:m.style.bottom=-parseInt(m.style.height)+"px",m.style.display="block",t()}else"function"==typeof a&&a(!1);return{done:function(e){a=e}}}}function l(){return m}function s(t,n){e.preloadFrames!==!1&&(n.preLoadAppInFrame(t),n.onReady(d));var i=t&&t.getElement();i&&(v.appendChild(i),t.onClick(u),n.onHide(c),x.push({app:t,frame:n}),f())}function p(){function t(e){if(parseInt(m.style.height)!=e){var n=parseInt(m.style.height)<e?1:-1,i=parseInt(m.style.height)+n;m.style.height=i+"px",m.firstChild.style.height=i+"px",i!=e&&setTimeout(function(){t(e)},1)}}m&&n.utils.isiPhone()&&n.utils.isNotChrome()&&t(screen.availHeight-window.innerHeight<60?(e.PanelHeight||90)+30:e.PanelHeight||90)}function d(e){for(var t=0;t<x.length;t++)if(!x[t].frame.isReady())return;b||r()}function c(e,t){e===w&&t&&(w=null,history.back())}function u(e){for(var t=0;t<x.length;t++){var i=!0;w&&(i=!1),x[t].app==e?w===x[t].frame?(n.http.engageEvent("CloseMiniApp",window.location.href,e.getAppId(),x.map(function(e){return e.app.getAppId()})),x[t].frame.hide(!0,!0),x[t].app.highlight(!1)):(n.http.engageEvent("OpenMiniApp",window.location.href,e.getAppId(),x.map(function(e){return e.app.getAppId()})),e.highlight(!0),x[t].frame.show(i),w||history.pushState({app:e.getAppName()},e.getAppName(),"#miniapp"),w=x[t].frame):(x[t].frame.hide(i),x[t].app.highlight(!1))}}function f(){for(var e=0,t=0;t<x.length;t++)e+=parseInt(x[t].app.getElement().style.width),e+=parseInt(x[t].app.getElement().style.marginLeft),e+=parseInt(x[t].app.getElement().style.marginRight);v.style.width=e+"px"}function h(t){var n=document.createElement("div"),i=document.createElement("div");return v=g(),i.style.position="relative",i.style.height=(t.PanelHeight||90)+"px",n.appendChild(i),i.appendChild(v),n.style.position="fixed",n.style.bottom=0,n.style.left=0,n.style.width="100%",n.style.height=(t.PanelHeight||90)+"px",n.style.opacity=t.PanelAlpha||1,n.style.backgroundColor=t.PanelBackground||"#404040",n.style.display="none",n.style.zIndex=1e3,n.style.webkitTransform="translateZ(2px)",n.style.webkitBackfaceVisibility="hidden",e.id&&(n.id=e.id),n}function g(){var e=document.createElement("div");return e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.webkitTransform="translate(-50%, -50%)",e}function y(){t(),m=h(e),p(),document.body.appendChild(m),window.addEventListener("resize",function(){p()},!0),window.addEventListener("popstate",function(e){w&&(w.hide(!1,!1),w=null)},!0)}e||(e={});var m,v,w,x=[],b=!1;return y(),{addMiniapp:s,removeMiniapp:i,getMiniapps:a,setStyle:{},getElement:l,hide:o,show:r}}var n=e.getInstance();n.addClass("Panel",t)}(),function(){function t(e){function t(){return A}function i(e){I.push(e)}function a(e){b.push(e)}function o(){return f}function r(e,t){function n(){var e=parseInt(f.style.left)-4;f.style.left=e+"px",e>-window.innerWidth?setTimeout(n,1):f.style.left=-window.innerWidth+"px"}if(x){e===!1?f.style.left=-window.innerWidth+"px":n(),x=!1;for(var i=0;i<b.length;i++)b[i](w,t)}}function l(e){function t(){var e=parseInt(f.style.left)+8;f.style.left=e+"px",0>e?setTimeout(t,16):f.style.left=0}n.utils.isNotChrome()&&(h.style.display="none",h.style.display="block"),e===!1?f.style.left=0:(f.style.left=-window.innerWidth+"px",t()),x=!0}function s(e){h.src="frame-wrapper.html?url="+e.getAppAddress(),f.style.left=-window.innerWidth+"px",f.style.display="block",m.src=e.getAppIcon(),v=e}function p(e){var t=document.createElement("div");return y=d(e),t.appendChild(y),t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="100%",t.style.height=window.innerHeight-(e.PanelHeight||90)+"px",t.style.webkitTransform="translateZ(1px)",t.style.webkitBackfaceVisibility="hidden",h=document.createElement("iframe"),g=document.createElement("div"),g.style.webkitOverflowScrolling="touch",g.style.overflowY="scroll",g.style.height=parseInt(t.style.height)-parseInt(y.style.height)+"px",g.style.backgroundColor="white",g.appendChild(h),h.width="100%",h.height="100%",h.style.border="none",h.addEventListener("load",function(){h.src&&window.addEventListener("message",function(e){if(e.data&&e.data.miniappFrameReady&&-1!=h.src.indexOf(e.data.url)){A=!0;for(var t=0;t<I.length;t++)I[t](w)}},!1)},!0),t.appendChild(g),t}function d(e){var t=document.createElement("div");t.style.textAlign="center",t.style.backgroundColor="#ffffff",t.style.border="1px #007AFF solid",t.style.height="45px",t.style.position="relative";var n=document.createElement("div");n.style.position="absolute",n.style.top="50%",n.style.width="100%",n.style.left=0,n.style.transform="translate(0, -50%)",n.style.webkitTransform="translate(0, -50%)",n.style.color="#000000",t.appendChild(n),m=document.createElement("img"),m.style.position="absolute",m.style.top=0,m.style.left="50%",m.style.transform="translate(-50%, 0)",m.style.webkitTransform="translate(-50%, 0)",m.style.width="45px",m.style.height="45px",m.style.marginTop="-11px",n.appendChild(m);var i=document.createElement("div");i.textContent=e.BackNavigationText,i.style["float"]="left",i.style.marginLeft="10px",i.style.cursor="pointer",window.getComputedStyle&&(i.style.fontFamily=window.getComputedStyle(document.body).fontFamily),i.style.fontSize="18px",i.onclick=function(){r(!0,!0)},n.appendChild(i);var a=document.createElement("img");return a.style["float"]="right",a.src="http://www.haaretz.co.il/htz/images/mobileweb/logo-haaretz.png",n.appendChild(a),t}function c(){f.style.height=window.innerHeight-(e.PanelHeight||45)+"px",g.style.height=parseInt(f.style.height)-parseInt(y.style.height)+"px"}function u(){f=p(e||{}),document.body.appendChild(f),window.addEventListener("resize",function(){c()},!0)}e||(e={});var f,h,g,y,m,v,w,x=!1,b=[],I=[],A=!1;return u(),w={getElement:o,preLoadAppInFrame:s,show:l,hide:r,onHide:a,isReady:t,onReady:i}}var n=e.getInstance();n.addClass("DisplayFrame",t)}(),function(){console.log("MiniAppSDK init");var t,n=e.getInstance(),i={publisher:"haaretz"};n.http.engageEvent("OpenArticle",window.location.href),n.http.getPanelStyle(i,function(e){e&&e[0]&&(e=e[0]),t=n.Panel(e);var i={link:"http://miniappjssdk.herokuapp.com/",publisher:"haaretz"};n.http.getMiniapps(i,function(i){console.log("MiniAppSDK "+i.length+" MiniApps"),i&&i.length&&i.length>0&&n.http.engageEvent("ShowMiniAppPanel",window.location.href,"",i.map(function(e){return e.id}));for(var a=0;a<i.length;a++)if(i[a]){var o=n.DisplayFrame(e),r=n.AppIcon(i[a]);t.addMiniapp(r,o),n.http.engageEvent("Impression",window.location.href,i[a].id,i.map(function(e){return e.id}))}setTimeout(function(){t.show()},5e3)})}),console.log("MiniAppSDK init completed")}()}}();