!function(){if(/mobile/i.test(navigator.userAgent)){var e=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function t(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function n(e,t,n){var i;if(localStorage)localStorage.setItem(e,t);else{if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),i=", expires="+o.toGMTString()}else i="";document.cookie=e+"="+t+i+", path=/"}}function i(e){if(localStorage)return localStorage.getItem(e);for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null}function o(){var e=i("miniappuuid");return null===e&&(e=t(),n("miniappuuid",e,365)),e}function a(){this.addClass=function(e,t){this[e]=t},this.addService=function(e,t){this[e]=t},this.getGuid=function(){return s}}function r(){var e=new a;return e}var l,s=o();return{getInstance:function(){return l||(l=r()),l}}}();!function(){e.getInstance().addService("http",function(){function t(e,t){var n=new XMLHttpRequest;n.open("HEAD",e),n.onreadystatechange=function(e){console.log(this.getAllResponseHeaders()),4==this.readyState&&200==this.status&&t(404!=this.status)},n.send()}function n(e,t,n){var i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(e){if(4==this.readyState&&200==this.status)try{var t=JSON.parse(this.response);n(t)}catch(i){n({})}};var o="";for(var a in t)o+=a+"="+t[a]+"&";i.send(o)}function i(e,t){n(r+"/api/miniapps/initparams/",e,function(e){t(e)})}function o(e,t){n(r+"/api/miniapps/related/",e,function(e){t(e)})}function a(t,i,o,a){var l={};navigator&&(l.language=navigator.language);var s={clientID:"",deviceID:"",action:t,timestamp:(new Date).getTime(),hostAppName:"haaretz",miniAppName:o||"",sdkVersion:"1.0web",hostAppUserId:"",os_name:"",os_version:"",device_brand:"",device_manufacturer:"",device_model:"",device_type:"",carrier:"web",language:l.language,ip:"",adIdentifier:e.getInstance().getGuid(),adid:"",articleURL:i,presentedMiniapps:a||["","","",""]};n(r+"/api/engagment/create/",s,function(){})}var r="http://dev.miniapp.me";return{getPanelStyle:i,getMiniapps:o,engageEvent:a,getHeaders:t}}())}(),function(){e.getInstance().addService("utils",function(){function e(){return/iPhone/i.test(navigator.userAgent)}function t(){return!/chrome|CriOS/i.test(navigator.userAgent)}return{isiPhone:e,isNotChrome:t}}())}(),function(){function t(e){function t(){return l}function n(e){g.push(e)}function i(e){s.style.boxShadow=e?"rgba(119, 219, 239, 0.75) 0px 0px 2px 2px":"none"}function o(){for(var e=0;e<g.length;e++)g[e](h)}function a(e){var t=document.createElement("div");t.style["float"]="left",t.style.marginRight="0px",t.style.marginLeft="0px",t.style.cursor="pointer",t.style.width="80px",t.style.textAlign="center",t.id=p,s=document.createElement("img"),s.style.borderRadius="5px",s.style.margin="auto",s.style.width="45px",s.style.height="45px",s.style.borderRadius="10px",s.src=c,t.appendChild(s);var n=document.createElement("div");n.style.textAlign="center",n.style.fontFamily="'Roboto', sans-serif",n.style.fontSize="11px",n.style.color="#ffffff";var i=d;return i.length>12&&(i=i.substr(0,10)+"..."),n.textContent=i,t.appendChild(n),t.onclick=function(){o()},t}function r(){p=e.id,c=e.icon,d=e.name,u=e.appAddress,f=e.appDownloadLink,l=a()}if(!(e&&e.icon&&e.id))return null;var l,s,p,d,c,u,f,h,g=[];return r(),h={getElement:t,getAppAddress:function(){return u},getAppDownloadLink:function(){return f},getAppIcon:function(){return c},getAppName:function(){return d},getAppId:function(){return p},onClick:n,highlight:i}}e.getInstance().addClass("AppIcon",t)}(),function(){function t(e){function t(){var e="miniappFontCSS";if(!document.getElementById(e)){var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.id=e,n.rel="stylesheet",n.type="text/css",n.href="http://fonts.googleapis.com/css?family=Roboto:300",n.media="all",t.appendChild(n)}}function i(e){v.removeChild(e.getElement());for(var t=0;t<b.length;t++)if(e==b[t].app)return document.body.removeChild(b[t].frame.getElement()),b.splice(t,1),void f()}function o(){return b}function a(){y.style.display="none"}function r(){function t(){var e=parseInt(y.style.bottom)+1;y.style.bottom=e+"px",0>e?setTimeout(t,1):"function"==typeof i&&i(!0)}function n(){var e=parseInt(y.style.left)+16;y.style.left=e+"px",0>e?setTimeout(n,16):(y.style.left=0,"function"==typeof i&&i(!0))}if(!x){var i;if(b.length>0)switch(x=!0,e.AnimationType){case 0:y.style.left=-window.innerWidth+"px",y.style.display="block",n();break;case 2:y.style.display="block","function"==typeof i&&i(!1);break;default:y.style.bottom=-parseInt(y.style.height)+"px",y.style.display="block",t()}else"function"==typeof i&&i(!1);return{done:function(e){i=e}}}}function l(){return y}function s(t,n){e.preloadFrames!==!1&&(n.preLoadAppInFrame(t),n.onReady(d));var i=t&&t.getElement();i&&(v.appendChild(i),t.onClick(u),n.onHide(c),b.push({app:t,frame:n}),f())}function p(){}function d(e){for(var t=0;t<b.length;t++)if(!b[t].frame.isReady())return;x||r()}function c(e,t){if(e===w&&t){w=null;for(var n=0;n<b.length;n++)e==b[n].frame&&b[n].app.highlight(!1);history.back()}}function u(t){for(var i=0;i<b.length;i++){var o=2!=e.AnimationType;w&&(o=!1),b[i].app==t?w===b[i].frame?(n.http.engageEvent("CloseMiniApp",window.location.href,t.getAppId(),b.map(function(e){return e.app.getAppId()})),b[i].frame.hide(!0,!0),b[i].app.highlight(!1)):(n.http.engageEvent("OpenMiniApp",window.location.href,t.getAppId(),b.map(function(e){return e.app.getAppId()})),t.highlight(!0),b[i].frame.show(o),w||history.pushState({app:t.getAppName()},t.getAppName(),"#miniapp"),w=b[i].frame):(b[i].frame.hide(o),b[i].app.highlight(!1))}}function f(){for(var e=0,t=0;t<b.length;t++)e+=parseInt(b[t].app.getElement().style.width),e+=parseInt(b[t].app.getElement().style.marginLeft),e+=parseInt(b[t].app.getElement().style.marginRight);v.style.width=e+"px"}function h(t){var n=document.createElement("div"),i=document.createElement("div");return v=g(),i.style.position="relative",i.style.height=(t.PanelHeight||90)+"px",n.appendChild(i),i.appendChild(v),n.style.position="fixed",n.style.bottom=0,n.style.left=0,n.style.width="100%",n.style.height=(t.PanelHeight||90)+"px",n.style.opacity=t.PanelAlpha||1,n.style.backgroundColor=t.PanelBackground||"#404040",n.style.display="none",n.style.zIndex=1e3,n.style.webkitTransform="translateZ(2px)",n.style.webkitBackfaceVisibility="hidden",e.id&&(n.id=e.id),n}function g(){var e=document.createElement("div");return e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.webkitTransform="translate(-50%, -50%)",e}function m(){t(),y=h(e),p(),document.body.appendChild(y),window.addEventListener("resize",function(){p()},!0),window.addEventListener("popstate",function(e){if(w){w.hide(!1,!1);for(var t=0;t<b.length;t++)w==b[t].frame&&b[t].app.highlight(!1);w=null}},!0)}e||(e={});var y,v,w,b=[],x=!1;return m(),{addMiniapp:s,removeMiniapp:i,getMiniapps:o,setStyle:{},getElement:l,hide:a,show:r}}var n=e.getInstance();n.addClass("Panel",t)}(),function(){function t(e){function t(){return E}function i(e){A.push(e)}function o(e){x.push(e)}function a(){return f}function r(t,n){function i(){var e=parseInt(f.style.left)-16;f.style.left=e+"px",e>-window.innerWidth?setTimeout(i,16):(f.style.left=-window.innerWidth+"px",h.style.display="none")}if(2==e.AnimationType&&(t=!1),b){t===!1?(f.style.left=-window.innerWidth+"px",h.style.display="none"):i(),b=!1;for(var o=0;o<x.length;o++)x[o](w,n)}}function l(e){function t(){var e=parseInt(f.style.left)+16;f.style.left=e+"px",0>e?setTimeout(t,16):f.style.left=0}n.utils.isNotChrome()&&(h.style.display="none",h.style.display="block"),e===!1?f.style.left=0:(f.style.left=-window.innerWidth+"px",t()),b=!0}function s(e){n.http.getHeaders("http://www.google.com/",function(){}),h.src="frame-wrapper.html?url="+e.getAppAddress(),f.style.left=-window.innerWidth+"px",y.textContent=e.getAppName(),v=e}function p(e){var t=document.createElement("div");return m=d(e),t.appendChild(m),t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.bottom=(e.PanelHeight||90)+"px",t.style.width="100%",t.style.webkitTransform="translateZ(1px)",t.style.webkitBackfaceVisibility="hidden",h=document.createElement("iframe"),g=document.createElement("div"),g.style.webkitOverflowScrolling="touch",g.style.overflowScrolling="touch",g.style.overflowY="scroll",g.style.position="fixed",g.style.top="45px",g.style.left=0,g.style.bottom=(e.PanelHeight||90)+"px",g.style.width="100%",g.style.height="100%",g.style.backgroundColor="white",g.appendChild(h),h.width="100%",h.height="100%",h.style.border="none",h.addEventListener("load",function(){h.src&&window.addEventListener("message",function(e){if(e.data&&e.data.miniappFrameReady&&-1!=h.src.indexOf(e.data.url)){E=!0;for(var t=0;t<A.length;t++)A[t](w)}},!1)},!0),t.appendChild(g),t}function d(e){var t=document.createElement("div");t.style.textAlign="center",t.style.backgroundColor="#ffffff",t.style.border="1px #007AFF solid",t.style.height="45px",t.style.position="relative";var n=document.createElement("div");n.style.position="absolute",n.style.top="50%",n.style.width="100%",n.style.left=0,n.style.transform="translate(0, -50%)",n.style.webkitTransform="translate(0, -50%)",n.style.color="#000000",t.appendChild(n),y=document.createElement("span"),n.appendChild(y);var i=document.createElement("div");i.textContent=e.BackNavigationText,i.style["float"]="left",i.style.marginLeft="10px",i.style.cursor="pointer",window.getComputedStyle&&(i.style.fontFamily=window.getComputedStyle(document.body).fontFamily),i.style.fontSize="18px",i.style.color="#007AFF",i.onclick=function(){r(!0,!0)},n.appendChild(i);var o=document.createElement("img");return o.style["float"]="right",o.src="http://www.haaretz.co.il/htz/images/mobileweb/logo-haaretz.png",n.appendChild(o),t}function c(){}function u(){f=p(e||{}),document.body.appendChild(f),window.addEventListener("resize",function(){c()},!0)}e||(e={});var f,h,g,m,y,v,w,b=!1,x=[],A=[],E=!1;return u(),w={getElement:a,preLoadAppInFrame:s,show:l,hide:r,onHide:o,isReady:t,onReady:i}}var n=e.getInstance();n.addClass("DisplayFrame",t)}(),function(){document.body.onload=function(){console.log("MiniAppSDK init");var t,n=e.getInstance(),i={publisher:"haaretz"};n.http.engageEvent("OpenArticle",window.location.href),n.http.getPanelStyle(i,function(e){e&&e[0]&&(e=e[0]),t=n.Panel(e);var i={link:window.location.href,publisher:"haaretz"};n.http.getMiniapps(i,function(i){console.log("MiniAppSDK "+i.length+" MiniApps"),i&&i.length&&i.length>0&&n.http.engageEvent("ShowMiniAppPanel",window.location.href,"",i.map(function(e){return e.id}));for(var o=0;o<i.length;o++)if(i[o]){var a=n.DisplayFrame(e),r=n.AppIcon(i[o]);t.addMiniapp(r,a),n.http.engageEvent("Impression",window.location.href,i[o].id,i.map(function(e){return e.id}))}setTimeout(function(){t.show()},e.LoadingTimeout||1e4)})}),console.log("MiniAppSDK init completed")}}()}}();