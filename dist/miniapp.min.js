!function(){if(/mobile/i.test(navigator.userAgent)){var e=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function t(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function n(e,t,n){var i;if(localStorage)localStorage.setItem(e,t);else{if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),i=", expires="+o.toGMTString()}else i="";document.cookie=e+"="+t+i+", path=/"}}function i(e){if(localStorage)return localStorage.getItem(e);for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null}function o(){var e=i("miniappuuid");return null===e&&(e=t(),n("miniappuuid",e,365)),e}function a(){this.addClass=function(e,t){this[e]=t},this.addService=function(e,t){this[e]=t},this.getGuid=function(){return s}}function r(){var e=new a;return e}var l,s=o();return{getInstance:function(){return l||(l=r()),l}}}();!function(){e.getInstance().addService("http",function(){function t(e,t){var n=new XMLHttpRequest;n.open("HEAD",e),n.onreadystatechange=function(e){console.log(this.getAllResponseHeaders()),4==this.readyState&&200==this.status&&t(404!=this.status)},n.send()}function n(e,t,n){var i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(e){if(4==this.readyState&&200==this.status)try{var t=JSON.parse(this.response);n(t)}catch(i){n({})}};var o="";for(var a in t)o+=a+"="+t[a]+"&";i.send(o)}function i(e,t){n(r+"/api/miniapps/initparams/",e,function(e){t(e)})}function o(e,t){n(r+"/api/miniapps/related/",e,function(e){t(e)})}function a(t,i,o,a){var l={};navigator&&(l.language=navigator.language);var s={clientID:"",deviceID:"",action:t,timestamp:(new Date).getTime(),hostAppName:"haaretz",miniAppName:o||"",sdkVersion:"1.0web",hostAppUserId:"",os_name:"",os_version:"",device_brand:"",device_manufacturer:"",device_model:"",device_type:"",carrier:"web",language:l.language,ip:"",adIdentifier:e.getInstance().getGuid(),adid:"",articleURL:i,presentedMiniapps:a||["","","",""]};n(r+"/api/engagment/create/",s,function(){})}var r="http://dev.miniapp.me";return{getPanelStyle:i,getMiniapps:o,engageEvent:a,getHeaders:t}}())}(),function(){e.getInstance().addService("utils",function(){function e(){return/iPhone/i.test(navigator.userAgent)}function t(){return/iPad/i.test(navigator.userAgent)}function n(){return!/chrome|CriOS/i.test(navigator.userAgent)}return{isiPhone:e,isiPad:t,isNotChrome:n}}())}(),function(){function t(e){function t(){return l}function n(e){m.push(e)}function i(e){s.style.boxShadow=e?"rgba(119, 219, 239, 0.75) 0px 0px 2px 2px":"none"}function o(){for(var e=0;e<m.length;e++)m[e](h)}function a(e){var t=document.createElement("div");t.style["float"]="left",t.style.marginRight="0px",t.style.marginLeft="0px",t.style.cursor="pointer",t.style.width="80px",t.style.textAlign="center",t.id=d,s=document.createElement("img"),s.style.borderRadius="5px",s.style.margin="auto",s.style.width="45px",s.style.height="45px",s.style.borderRadius="10px",s.src=c,t.appendChild(s);var n=document.createElement("div");n.style.textAlign="center",n.style.fontFamily="'Roboto', sans-serif",n.style.fontSize="11px",n.style.color="#ffffff",n.style.direction="rtl";var i=p;return i.length>12&&(i=i.substr(0,11)+".."),n.textContent=i,t.appendChild(n),t.addEventListener("touchstart",function(e){g=e.touches[0]},!0),t.addEventListener("touchmove",function(e){g=e.touches[0],e.preventDefault(),e.stopPropagation()},!0),t.addEventListener("touchend",function(e){var t=l.getBoundingClientRect();g.clientX>=t.left&&g.clientX<=t.right&&g.clientY>=t.top&&g.clientY<=t.bottom&&o()},!0),t}function r(){d=e.id,c=e.icon,p=e.name,u=e.appAddress,f=e.appDownloadLink,l=a()}if(!(e&&e.icon&&e.id))return null;var l,s,d,p,c,u,f,h,g,m=[];return r(),h={getElement:t,getAppAddress:function(){return u},getAppDownloadLink:function(){return f},getAppIcon:function(){return c},getAppName:function(){return p},getAppId:function(){return d},onClick:n,highlight:i}}e.getInstance().addClass("AppIcon",t)}(),function(){function t(e){function t(){var e="miniappFontCSS";if(!document.getElementById(e)){var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.id=e,n.rel="stylesheet",n.type="text/css",n.href="http://fonts.googleapis.com/css?family=Roboto:300",n.media="all",t.appendChild(n)}}function i(e){x.removeChild(e.getElement());for(var t=0;t<C.length;t++)if(e==C[t].app)return C[t].frame.remove(),C.splice(t,1),void g()}function o(){return C}function a(){b.style.display="none",document.body.removeChild(E)}function r(){function t(e){e&&document.body.appendChild(E),"function"==typeof o&&o(e)}function n(){var e=parseInt(b.style.bottom)+1;b.style.bottom=e+"px",0>e?setTimeout(n,1):t(!0)}function i(){var e=parseInt(b.style.left)+16;b.style.left=e+"px",0>e?setTimeout(i,16):(b.style.left=0,t(!0))}if(!I){var o;if(C.length>0)switch(I=!0,e.AnimationType){case 0:b.style.left=-window.innerWidth+"px",b.style.display="block",i();break;case 2:b.style.display="block",t(!0);break;default:b.style.bottom=-parseInt(b.style.height)+"px",b.style.display="block",n()}else t(!1);return{done:function(e){o=e}}}}function l(){return b}function s(t,n){e.preloadFrames!==!1&&(n.preLoadAppInFrame(t),n.onReady(d));var i=t&&t.getElement();i&&(x.appendChild(i),t.onClick(h),n.onHide(c),C.push({app:t,frame:n}),g())}function d(e){for(var t=0;t<C.length;t++)if(!C[t].frame.isReady())return;I||r()}function p(e){A=null;for(var t=0;t<C.length;t++)e==C[t].frame&&C[t].app.highlight(!1);u()}function c(e,t){e===A&&t&&p(e)}function u(){for(var e=0;e<k.length;e++)k[e].element.style.display=k[e].display;k=[]}function f(e){for(var t=[e.frame.getIframe(),b,E,e.frame.getTitle()],n=0;n<document.body.children.length;n++){var i=document.body.children[n];-1==t.indexOf(i)&&"none"!=i.style.display&&(k.push({element:i,display:i.style.display}),i.style.display="none")}}function h(t){for(var i=0;i<C.length;i++){var o=2!=e.AnimationType;A&&(o=!1),C[i].app==t?A===C[i].frame?(n.http.engageEvent("CloseMiniApp",window.location.href,t.getAppId(),C.map(function(e){return e.app.getAppId()})),C[i].frame.hide(!0,!0),C[i].app.highlight(!1)):(n.http.engageEvent("OpenMiniApp",window.location.href,t.getAppId(),C.map(function(e){return e.app.getAppId()})),t.highlight(!0),C[i].frame.show(o),f(C[i]),A||history.pushState({app:t.getAppName()},t.getAppName()),A=C[i].frame):(C[i].frame.hide(o),C[i].app.highlight(!1))}}function g(){for(var e=0,t=0;t<C.length;t++)e+=parseInt(C[t].app.getElement().style.width),e+=parseInt(C[t].app.getElement().style.marginLeft),e+=parseInt(C[t].app.getElement().style.marginRight);x.style.width=e+"px"}function m(t){var n=document.createElement("div"),i=document.createElement("div");return x=y(),i.style.position="relative",i.style.height=(t.PanelHeight||90)+"px",n.appendChild(i),i.appendChild(x),n.style.position="fixed",n.style.bottom=0,n.style.left=0,n.style.width="100%",n.style.height=(t.PanelHeight||90)+"px",n.style.opacity=t.PanelAlpha||1,n.style.backgroundColor=t.PanelBackground||"#404040",n.style.display="none",n.style.zIndex=1e3,n.style.webkitTransform="translateZ(2px)",n.style.webkitBackfaceVisibility="hidden",e.id&&(n.id=e.id),n}function y(){var e=document.createElement("div");return e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.webkitTransform="translate(-50%, -50%)",e}function v(e){var t=document.createElement("div");return t.style.height=e+"px",t.style.width="1px",t}function w(){t(),b=m(e),E=v(e.PanelHeight||90),document.body.appendChild(b),window.addEventListener("popstate",function(e){A&&(A.hide(!1,!1),p(A))},!0),b.addEventListener("touchmove",function(e){for(var t=0;t<C.length;t++){var n=C[t].app.getElement().children;for(var i in n)if(n[i]==e.target)return!0}e.stopPropagation(),e.preventDefault()},!0)}e||(e={});var b,x,A,E,C=[],I=!1,k=[];return w(),{addMiniapp:s,removeMiniapp:i,getMiniapps:o,setStyle:{},getElement:l,hide:a,show:r}}var n=e.getInstance();n.addClass("Panel",t)}(),function(){function t(e){function t(){document.body.removeChild(g),document.body.removeChild(m)}function i(){return C}function o(e){E.push(e)}function a(e){A.push(e)}function r(){return m}function l(){return g}function s(t,n){if(2==e.AnimationType&&(t=!1),x){m.style.display="none",g.style.display="none",h.style.display="none",x=!1;for(var i=0;i<A.length;i++)A[i](w,n)}}function d(){h.src!==v.getAppAddress()&&(h.src=v.getAppAddress()),m.style.display="block",g.style.display="block",h.style.display="block",x=!0}function p(e){y.textContent=e.getAppName(),v=e}function c(e){h=document.createElement("iframe"),g=document.createElement("div"),g.style.webkitOverflowScrolling="touch",g.style.overflow="scroll",g.style.width=window.innerWidth+"px",g.style.margin=0,g.style.display="none",g.style.zIndex=999,g.style.marginLeft="-8px",g.style.marginTop="45px",n.utils.isiPhone()||n.utils.isiPad()||(g.style.height=window.innerHeight+"px"),g.style.backgroundColor="white",h.width=window.innerWidth+"px",h.height="100%",h.style.border="none";var t=document.createElement("img");return t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.webkitTransform="translate(-50%, -50%)",t.src="ajax-loader.gif",h.addEventListener("load",function(){if(h.src){C=!0;for(var e=0;e<E.length;e++)t.style.display="none",E[e](w)}},!0),g.appendChild(t),g.appendChild(h),g}function u(e){var t=document.createElement("div");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="100%",t.style.zIndex=1e3,t.style.display="none";var n=document.createElement("div");n.style.textAlign="center",n.style.backgroundColor="#ffffff",n.style.border="1px #007AFF solid",n.style.height="45px",n.style.position="relative";var i=document.createElement("div");i.style.position="absolute",i.style.top="50%",i.style.width="100%",i.style.left=0,i.style.transform="translate(0, -50%)",i.style.webkitTransform="translate(0, -50%)",i.style.color="#000000",n.appendChild(i),y=document.createElement("span"),i.appendChild(y);var o=document.createElement("div");o.textContent=e.BackNavigationText,o.style["float"]="left",o.style.marginLeft="10px",o.style.cursor="pointer",window.getComputedStyle&&(o.style.fontFamily=window.getComputedStyle(document.body).fontFamily),o.style.fontSize="18px",o.style.color="#007AFF",o.addEventListener("touchstart",function(e){b=e.touches[0]},!0),o.addEventListener("touchmove",function(e){b=e.touches[0],e.preventDefault(),e.stopPropagation()},!0),o.addEventListener("touchend",function(e){var t=o.getBoundingClientRect();b.clientX>=t.left&&b.clientX<=t.right&&b.clientY>=t.top&&b.clientY<=t.bottom&&s(!0,!0)},!0),i.appendChild(o);var a=document.createElement("img");return a.style["float"]="right",a.style.height="30px",a.style.width="100px",window.location.origin.indexOf("haaretz")>-1?a.src="http://www.haaretz.co.il/htz/images/mobileweb/logo-haaretz.png":window.location.origin.indexOf("themarker")>-1?a.src="http://www.themarker.com/images/mobileweb/logo-marker@2x.png":a.style.visibility="hidden",i.appendChild(a),t.appendChild(n),t}function f(){g=c(e||{}),document.body.insertBefore(g,document.body.firstElementChild),m=u(e||{}),document.body.appendChild(m)}e||(e={});var h,g,m,y,v,w,b,x=!1,A=[],E=[],C=!1;return f(),w={getTitle:r,preLoadAppInFrame:p,show:d,hide:s,onHide:a,isReady:i,onReady:o,getIframe:l,remove:t}}var n=e.getInstance();n.addClass("DisplayFrame",t)}(),function(){document.body.onload=function(){console.log("MiniAppSDK init");var t,n=e.getInstance(),i={publisher:"haaretz"};n.http.engageEvent("OpenArticle",window.location.href),n.http.getPanelStyle(i,function(e){e&&e[0]&&(e=e[0]),t=n.Panel(e);var i={link:window.location.href,publisher:"haaretz"};n.http.getMiniapps(i,function(i){console.log("MiniAppSDK "+i.length+" MiniApps"),i&&i.length&&i.length>0&&n.http.engageEvent("ShowMiniAppPanel",window.location.href,"",i.map(function(e){return e.id}));for(var o=0;o<i.length;o++)if(i[o]){var a=n.DisplayFrame(e),r=n.AppIcon(i[o]);t.addMiniapp(r,a),n.http.engageEvent("Impression",window.location.href,i[o].id,i.map(function(e){return e.id}))}setTimeout(function(){t.show()},e.LoadingTimeout||1e4)})}),console.log("MiniAppSDK init completed")}}()}}();